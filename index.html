<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
   
</head>
<body>
<div class="header">
    
    <span style="font-size:26px;font-weight:bolder;">Minehut SimpleStats</span>
    <div class="header-buttons">
        <a href="#top" class="hov-green">Data</a>
        <a href="#analysis" class="hov-blue">Analysis</a>
    </div>
</div>
<br><br><br>
<span id="top"></span>
<div class="stats">
    <h2 style="font-size:28px;">Statistics:</h2>
    <hr>
    <pre style="font-size:32px;font-weight:bolder;margin:4px;" id="srv">Servers: 0/0</pre>
    <pre style="font-size:32px;font-weight:bolder;margin:4px;" id="plr">Players: 0</pre>
    <pre style="font-size:32px;font-weight:bolder;margin:4px;" id="mem">RAM: 0GB/0GB</pre>
    <pre id="date">Time Pinged: 0000-00-00T00:00:00.000Z</pre>
    <canvas class="graph" id="graph" width="360" height="200"></canvas>
</div><br><br>
<div class="stats" id="analysis">
    <h2 style="font-size:28px;">Common Patterns (times in EST):</h2>
    <pre id="est">Time in EST: 00:00:00 AM</pre>
    <hr>
    <h2>Weekends</h2>
    <pre style="font-size:20px;">Peak Hours: 12pm - 4pm</pre>
    <pre style="font-size:20px;">Non-Peak Hours: 10pm - 8am</pre>
    <pre style="font-size:20px;">Full Capacity Hours: 11am - 4pm</pre>
    <br>
    <h2>Weekdays</h2>
    <pre style="font-size:20px;">Peak Hours: 12pm - 4pm</pre>
    <pre style="font-size:20px;">Non-Peak Hours: 10pm - 12pm</pre>
    <pre style="font-size:20px;">Full Capacity Hours: none</pre>
    <br>
    <pre style="font-size:20px;" id="ph">Currently in peak hours: N/A</pre>
</div>

   <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
mdata = {"players":[],"servers":[],"ram":[],"dates":[]};

		//{name: 'Servers', points: sc},
		//{name: 'Players', points: plr}
	

        /* Get data from API */
        function returnStats() {
    var tmp = null;
    $.ajax({
        'async': false,
        'type': "GET",
        'timeout': 9999,
        'global': false,
        'dataType': 'json',
        'url': "https://api.minehut.com/network/simple_stats",
        'cache': false,
        'success': function (data) {
            tmp = data;
        }
    });
    return tmp;
};
const ctx = document.getElementById('graph');
cc = new Chart(ctx, {
    type: 'line',
    data: {
        labels: mdata.dates,
        datasets: [
          {
            label:["Hundred Servers"],
            data: mdata.servers,
           
          },
          {
            label:["TB of RAM"],
            data: mdata.ram,
           
          },
          {
            label:["Thousand Players"],
            data: mdata.players,
           
          }
        ]
      },
    options: {
     innerWidth: 360,
     innerHeight:200
    }
  }); 
  cc.options.elements.line.tension = 0.4;
        
  
/* Update Counters */
function update() {
    
    let jd = returnStats();
console.log(jd);
    let servers = jd.server_count;
let servermax = jd.server_max;
let plr = jd.player_count;
let ram = Math.floor(jd.ram_count/1024);
let rammax = Math.floor(jd.ram_max);
let date = new Date().toJSON();
if (jd.ok == "false") {document.getElementById('srv').innerText = `Servers: N/A`;
document.getElementById('plr').innerText = `Players: N/A`;
document.getElementById('mem').innerText = `RAM: N/A`;} else {
    document.getElementById('srv').innerText = `Servers: ${servers}/${servermax} (${Math.floor((servers/servermax)*100)}%)`;
document.getElementById('plr').innerText = `Players: ${plr}`;
document.getElementById('mem').innerText = `RAM: ${ram}GB/${rammax}GB (${Math.floor((ram/rammax)*100)}%)`;}
document.getElementById('date').innerText = `Date Pinged: ${date}`;
mdata.servers.push(servers/100)
mdata.players.push(plr/1000)
mdata.ram.push(ram/1024)
mdata.dates.push(" ")

cc.data.datasets[0].data = mdata.servers 
cc.data.datasets[1].data = mdata.ram
cc.data.datasets[2].data = mdata.players
cc.update()
}



update()

setInterval(function() {update(); console.log(mdata);},5000)
setInterval(function() {
    let date = new Date().toLocaleString("en-US", { timeZone: "America/New_York" });
    
    document.getElementById('est').innerText = "Time in EST: " + date;
    date = new Date(date);
    let hour = date.getHours() + 1
    if (hour > 12 && hour < 16) {
        document.getElementById("ph").innerText = "Currently in peak hours: yes"
    } else {
        document.getElementById("ph").innerText = "Currently in peak hours: no"
    }
},1000)
    </script>
     <!-- CSS -->

    <link rel="stylesheet" href="index.css">
    
</body>
</html>